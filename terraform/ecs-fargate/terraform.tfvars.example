# ============================================================================
# TERRAFORM VARIABLES - Example Configuration
# ============================================================================
# Copy this file to terraform.tfvars and customize for your deployment
#
# Usage:
#   cp terraform.tfvars.example terraform.tfvars
#   # Edit terraform.tfvars with your values
#   terraform init
#   terraform plan
#   terraform apply

# ----------------------------------------------------------------------------
# Basic Configuration
# ----------------------------------------------------------------------------

project_name = "karmacadabra"
environment  = "prod"
aws_region   = "us-east-1" # Cheapest region

tags = {
  Project     = "Karmacadabra"
  ManagedBy   = "Terraform"
  Environment = "prod"
  Owner       = "your-name"
  CostCenter  = "ai-agents"
}

# ----------------------------------------------------------------------------
# VPC Configuration
# ----------------------------------------------------------------------------

vpc_cidr           = "10.0.0.0/16"
availability_zones = ["us-east-1a", "us-east-1b"]

# COST CRITICAL: Use single NAT Gateway to save ~$32/month
enable_nat_gateway = true
single_nat_gateway = true # IMPORTANT: Set to true for cost savings

# Enable VPC endpoints to reduce NAT data transfer costs
enable_vpc_endpoints = true

# ----------------------------------------------------------------------------
# ECS Configuration
# ----------------------------------------------------------------------------

# COST CRITICAL: Start with smallest possible Fargate sizes
task_cpu    = 256 # 0.25 vCPU
task_memory = 512 # 0.5 GB RAM

# COST CRITICAL: Use Fargate Spot for 70% savings
use_fargate_spot         = true # MUST BE TRUE
fargate_spot_base_capacity = 0    # 0% on-demand, 100% Spot
fargate_spot_weight        = 100  # Prefer Spot
fargate_ondemand_weight    = 1    # Fallback to on-demand if Spot unavailable

# Number of tasks per service (start with 1)
desired_count_per_service = 1

# Observability
enable_container_insights = true
enable_execute_command    = true # For debugging

# ----------------------------------------------------------------------------
# Auto-Scaling Configuration
# ----------------------------------------------------------------------------

enable_autoscaling        = true
autoscaling_min_capacity  = 1
autoscaling_max_capacity  = 3 # Conservative to control costs
autoscaling_cpu_target    = 75
autoscaling_memory_target = 80

# ----------------------------------------------------------------------------
# Agent Configuration
# ----------------------------------------------------------------------------
# Default configuration is already set in variables.tf
# Override only if you need different ports or health check paths

# agents = {
#   validator = {
#     port              = 9001
#     health_check_path = "/health"
#     priority          = 100
#   }
#   karma-hello = {
#     port              = 9002
#     health_check_path = "/health"
#     priority          = 200
#   }
#   # ... etc
# }

# ----------------------------------------------------------------------------
# Secrets Configuration
# ----------------------------------------------------------------------------

secrets_manager_secret_name = "karmacadabra"

# ----------------------------------------------------------------------------
# Load Balancer Configuration
# ----------------------------------------------------------------------------

alb_idle_timeout       = 60
enable_alb_access_logs = false # Disabled to save S3 costs
alb_deletion_protection = false

# ----------------------------------------------------------------------------
# CloudWatch Configuration (COST OPTIMIZATION)
# ----------------------------------------------------------------------------

log_retention_days   = 7    # Short retention to minimize storage costs
enable_xray_tracing  = true # Helpful for debugging

# ----------------------------------------------------------------------------
# Health Check Configuration
# ----------------------------------------------------------------------------

health_check_interval           = 30
health_check_timeout            = 5
health_check_healthy_threshold   = 2
health_check_unhealthy_threshold = 3

# ----------------------------------------------------------------------------
# Service Connect (Inter-Agent Communication)
# ----------------------------------------------------------------------------

enable_service_connect   = true
service_connect_namespace = "karmacadabra.local"

# ----------------------------------------------------------------------------
# Domain Configuration (Optional)
# ----------------------------------------------------------------------------

# Leave empty to skip Route53 configuration
domain_name           = "" # e.g., "karmacadabra.ultravioletadao.xyz"
create_route53_records = false

# ----------------------------------------------------------------------------
# Monitoring & Alerting
# ----------------------------------------------------------------------------

# Leave empty to skip SNS notifications (saves costs)
alarm_sns_topic_name = "" # e.g., "karmacadabra-alarms"

# Alarm configuration
enable_high_cpu_alarm    = true
enable_high_memory_alarm = true
enable_task_count_alarm  = true
cpu_alarm_threshold      = 85
memory_alarm_threshold   = 85

# ============================================================================
# COST OPTIMIZATION CHECKLIST
# ============================================================================
#
# ✅ use_fargate_spot = true (70% cost savings)
# ✅ single_nat_gateway = true (~$32/month savings)
# ✅ task_cpu = 256, task_memory = 512 (smallest size)
# ✅ autoscaling_max_capacity = 3 (prevent runaway scaling)
# ✅ log_retention_days = 7 (minimize CloudWatch Logs costs)
# ✅ enable_alb_access_logs = false (skip S3 storage costs)
# ✅ enable_vpc_endpoints = true (reduce NAT data transfer)
#
# ESTIMATED MONTHLY COST: ~$79-96
# - Fargate Spot (5 agents): ~$25-40
# - ALB: ~$16-18
# - NAT Gateway: ~$32
# - CloudWatch: ~$5-8
# - ECR: ~$1-2
#
# WAYS TO REDUCE FURTHER:
# - Scale down to 0 tasks when not in use
# - Use even smaller task sizes if your agents can handle it
# - Disable Container Insights (saves ~$3/month)
# - Use scheduled scaling (run only during business hours)
