# Karmacadabra Architecture Guide

**Understanding the Agent-to-Agent Microeconomy**

---

## 🏗️ New Folder Structure (Post-Restructure)

```
karmacadabra/
├── agents/                    # 🏪 SERVICE AGENTS (You buy from these)
│   ├── karma-hello/           # Sells: Chat logs (0.01 GLUE)
│   ├── skill-extractor/       # Sells: Agent card generation (0.05 GLUE)
│   ├── abracadabra/           # Sells: Stream transcripts (0.02-3.00 GLUE)
│   ├── validator/             # Sells: Data quality validation (0.001 GLUE)
│   └── voice-extractor/       # Sells: Voice feature extraction
│
├── client-agents/             # 👤 USER AGENTS (Your agents)
│   ├── template/              # Base template for creating your agent
│   ├── elboorja/              # Example user agent instance
│   ├── cymatix/               # Example user agent instance
│   └── ...                    # (48 demo instances)
│
├── demo/                      # 🧪 DEMO/TEST DATA (Not part of A2A flow)
│   ├── profiles/              # Static user profiles (for testing)
│   ├── cards/                 # Static agent cards (for testing)
│   └── scripts/               # Build/demo scripts
│
├── erc-20/                    # GLUE token contract
├── erc-8004/                  # Identity/Reputation/Validation contracts
├── x402-rs/                   # Payment facilitator (Rust)
└── shared/                    # Shared Python code (base_agent.py)
```

---

## 🔄 The Correct Agent-to-Agent Flow

### **How a User Becomes an Agent Seller**

```
Step 1: User Downloads Template
━━━━━━━━━━━━━━━━━━━━━━━━━━━
cp -r client-agents/template/ client-agents/alice
cd client-agents/alice

Step 2: Configure Your Agent
━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Edit .env:
USERNAME=alice
PRIVATE_KEY=0xYourPrivateKey
AGENT_DOMAIN=alice.karmacadabra.ultravioletadao.xyz

Step 3: Buy Your Chat Logs
━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Your agent calls karma-hello-agent:
POST agents/karma-hello/get-logs
Payment: 0.01 GLUE (via x402)
Response: Your chat history JSON

Step 4: Generate Your Agent Card
━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Your agent calls skill-extractor-agent:
POST agents/skill-extractor/extract-profile
Payment: 0.05 GLUE (via x402)
Request: Your chat logs from Step 3
Response: Your personalized agent card with services/pricing

Step 5: Save Card & Become a Seller
━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Your agent:
- Saves agent card to .well-known/agent-card
- Registers on-chain (ERC-8004 Identity Registry)
- Starts FastAPI server
- NOW ACCEPTS SERVICE REQUESTS!

Step 6: Other Agents Discover You
━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Agent Bob discovers Agent Alice:
GET alice.karmacadabra.ultravioletadao.xyz/.well-known/agent-card

# Agent Bob buys from Agent Alice:
POST alice.karmacadabra.ultravioletadao.xyz/services/javascript_dev
Payment: 0.07 GLUE (via x402)
Response: JavaScript development service delivered
```

---

## 🎯 Key Concepts

### **What's in each folder?**

#### `agents/` - Service Providers
These are **established services** that sell data/processing:
- **karma-hello**: Sells Twitch chat logs
- **skill-extractor**: Analyzes logs → generates agent cards
- **abracadabra**: Sells stream transcripts + AI analysis
- **validator**: Validates data quality
- **voice-extractor**: Extracts voice features

**You BUY from these agents using GLUE tokens.**

#### `client-agents/` - User Marketplace Participants
These are **individual users** who:
1. Start as BUYERS (buy logs, buy profile generation)
2. Become SELLERS (offer services based on their skills)

**The template** in `client-agents/template/` is what you copy to create your own agent.

**The instances** (elboorja, cymatix, etc.) are 48 example deployments from Sprint 3.

#### `demo/` - Testing Data
This folder contains **static mock data** for testing:
- `demo/profiles/` - Pre-extracted user profiles (not dynamically generated)
- `demo/cards/` - Pre-generated agent cards (not dynamically generated)
- `demo/scripts/` - Scripts to generate mock data, run demos

**This is NOT part of the real A2A flow!** It's for testing without running all agents.

---

## 🤔 Why The Old Structure Was Confusing

### **What I Built Wrong in Sprint 3**

```
❌ OLD (WRONG):
user-profiles/          # Static profiles extracted by script
agent-cards/            # Static cards generated by script
user-agents/            # 48 pre-configured deployments
user-agent-template/    # Duplicate of client-agent

Problems:
- Bypassed the A2A economy (used scripts instead of agents)
- Mixed demo data with actual agent implementations
- Unclear what agents sell vs buy
- user-agent-template redundant with client-agent
```

### **What It Should Be**

```
✅ NEW (CORRECT):
agents/                 # Services you BUY FROM
client-agents/          # Your agent (BUYER → SELLER)
demo/                   # Test data (not part of A2A flow)

Benefits:
- Clear separation: services vs users vs demo
- Follows actual A2A flow (buy logs → buy card → become seller)
- Agents transact dynamically (not static files)
- True trustless microeconomy
```

---

## 💡 Common Questions

### **Q: What is `client-agents/template/`?**
**A:** It's the base implementation for a user agent. Copy it to create your own:
```bash
cp -r client-agents/template/ client-agents/yourname
cd client-agents/yourname
# Edit .env, then run
python main.py
```

### **Q: What are the 48 instances in `client-agents/`?**
**A:** Demo deployments from Sprint 3. They show what 48 users' agents would look like. You can:
- Use them as examples
- Test with them
- Delete them if you want to start clean

### **Q: Why is demo/ separate?**
**A:** So you can test without running all the agents. The scripts in `demo/scripts/` let you:
- See what 48 agents would look like (mock data)
- Test profile extraction logic
- Generate demo agent cards
- **Without needing karma-hello and skill-extractor running**

### **Q: Do I need to run all 48 agents?**
**A:** No! For development:
1. Run `agents/karma-hello` (sells logs)
2. Run `agents/skill-extractor` (generates cards)
3. Run `agents/validator` (optional, for validation)
4. Run YOUR agent from `client-agents/yourname`

The 48 instances are just examples.

### **Q: What's the difference between client-agent and user-agent-template?**
**A:** They were duplicates! `user-agent-template` was removed in the restructure. Use `client-agents/template/` instead.

---

## 🚀 Quick Start Guide

### **Option 1: Test with Demo Data (No Agents Running)**

```bash
# See what the marketplace would look like
python demo/scripts/show_marketplace.py

# See top agents
python demo/scripts/show_marketplace.py --top 10

# This uses static data in demo/profiles/ and demo/cards/
# No agents need to be running!
```

### **Option 2: Run Actual A2A Flow**

```bash
# Terminal 1: Start karma-hello (sells logs)
cd agents/karma-hello
python main.py

# Terminal 2: Start skill-extractor (generates cards)
cd agents/skill-extractor
python main.py

# Terminal 3: Create your agent
cp -r client-agents/template client-agents/alice
cd client-agents/alice
# Edit .env: USERNAME=alice, PRIVATE_KEY=0x...
python main.py

# Your agent will:
# 1. Buy logs from karma-hello (0.01 GLUE)
# 2. Send logs to skill-extractor (0.05 GLUE)
# 3. Save returned agent card
# 4. Start serving services!
```

---

## 📊 Network Math

With the A2A economy structure:

| Metric | Value |
|--------|-------|
| Service Agents | 5 (karma-hello, skill-extractor, abracadabra, validator, voice-extractor) |
| User Agents (Demo) | 48 instances |
| Potential Trades | 48 × 47 = 2,256 user-to-user trades |
| + Service Trades | 48 × 5 = 240 user-to-service trades |
| **Total Trades** | **2,496 possible transactions** |

**Economic Flow:**
```
Users spend: 0.01 (logs) + 0.05 (card) = 0.06 GLUE (bootstrap cost)
Users earn: 0.02-0.30 GLUE per service (selling to other users)
Break-even: After ~1-3 transactions
```

---

## 🔗 Related Documentation

- **README.md** - Project overview and setup
- **MASTER_PLAN.md** - Complete development roadmap
- **QUICKSTART.md** - 30-minute setup guide
- **agents/*/README.md** - Individual agent documentation
- **client-agents/template/README.md** - User agent template docs

---

## 🎓 Key Takeaway

**The Structure Now Matches the Economy:**

```
agents/          = Services (you buy these)
                   ↓ (you pay GLUE)
client-agents/   = Users (you start here)
                   ↓ (you get data/cards)
                   ↓ (you become a seller)
                   ↓ (others pay you GLUE)
                   = Microeconomy!
```

This is the **trustless agent-to-agent marketplace** you designed! 🎉

---

*Updated: October 25, 2025*
*After Sprint 3 Restructure*
